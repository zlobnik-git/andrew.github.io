<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройки профиля - EduFlow</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/personal.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Боковая панель -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../../index.html" class="sidebar-logo">
                <i class="fas fa-graduation-cap"></i>
                <span>EduFlow</span>
            </a>
            
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">
                    <span>АЖ</span>
                </div>
                <div class="user-info">
                    <h3>Алексей Журавлев</h3>
                    <p>Ученик</p>
                </div>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Дашборд</span>
            </a>
            <a href="courses.html" class="nav-item">
                <i class="fas fa-book-open"></i>
                <span>Мои курсы</span>
            </a>
            <a href="progress.html" class="nav-item">
                <i class="fas fa-chart-line"></i>
                <span>Прогресс</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Расписание</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-tasks"></i>
                <span>Задания</span>
                <span class="badge">3</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-file-alt"></i>
                <span>Материалы</span>
            </a>
            <a href="profile.html" class="nav-item active">
                <i class="fas fa-user-cog"></i>
                <span>Настройки</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <a href="../../index.html" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Выйти</span>
            </a>
        </div>
    </aside>

    <!-- Основной контент -->
    <main class="personal-content">
        <header class="personal-header">
            <div>
                <h1>Настройки профиля</h1>
                <p>Управление личными данными и настройками аккаунта</p>
            </div>
            
            <div class="header-actions">
                <button class="mobile-menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>

        <!-- Вкладки настроек -->
        <div class="tabs" style="margin-bottom: var(--space-xl);">
            <button class="tab-btn active" data-tab="profile">Профиль</button>
            <button class="tab-btn" data-tab="security">Безопасность</button>
            <button class="tab-btn" data-tab="notifications">Уведомления</button>
            <button class="tab-btn" data-tab="billing">Оплата</button>
            <button class="tab-btn" data-tab="privacy">Приватность</button>
        </div>

        <!-- Содержимое вкладок -->
        <div id="tabContent">
            <!-- Вкладка Профиль -->
            <div class="tab-pane active" id="profileTab">
                <div class="dashboard-card">
                    <h3><i class="fas fa-user"></i> Личная информация</h3>
                    
                    <form id="profileForm">
                        <div style="display: flex; align-items: center; gap: var(--space-xl); margin-bottom: var(--space-xl);">
                            <div style="text-align: center;">
                                <div class="user-avatar" id="avatarPreview" style="width: 120px; height: 120px; font-size: 2.5rem; margin: 0 auto var(--space-sm);">
                                    <span>АЖ</span>
                                </div>
                                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                                <button type="button" class="btn btn-outline btn-small" id="changeAvatarBtn">
                                    <i class="fas fa-camera"></i> Изменить фото
                                </button>
                            </div>
                            
                            <div style="flex: 1;">
                                <div class="form-group">
                                    <label for="fullName">ФИО</label>
                                    <input type="text" id="fullName" value="Алексей Журавлев" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" value="alexey@example.com" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Телефон</label>
                            <input type="tel" id="phone" value="+7 (999) 123-45-67">
                        </div>
                        
                        <div class="form-group">
                            <label for="birthDate">Дата рождения</label>
                            <input type="date" id="birthDate" value="2006-05-15">
                        </div>
                        
                        <div class="form-group">
                            <label for="city">Город</label>
                            <input type="text" id="city" value="Москва">
                        </div>
                        
                        <div class="form-group">
                            <label for="about">О себе</label>
                            <textarea id="about" rows="3" placeholder="Расскажите о себе...">Учусь в 11 классе, готовлюсь к ЕГЭ по математике и информатике. Цель — поступить в технический вуз.</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="education">Образование</label>
                            <select id="education">
                                <option value="school">Школа</option>
                                <option value="college" selected>Колледж</option>
                                <option value="university">ВУЗ</option>
                                <option value="other">Другое</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="class">Класс/Курс</label>
                            <input type="text" id="class" value="3ИСИП-723">
                        </div>
                        
                        <div style="display: flex; gap: var(--space-md); margin-top: var(--space-xl);">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Сохранить изменения
                            </button>
                            <button type="button" class="btn btn-outline" id="cancelChangesBtn">
                                Отмена
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Вкладка Безопасность -->
            <div class="tab-pane" id="securityTab">
                <div class="dashboard-card">
                    <h3><i class="fas fa-shield-alt"></i> Безопасность аккаунта</h3>
                    
                    <div style="margin-bottom: var(--space-xl);">
                        <h4>Смена пароля</h4>
                        <form id="passwordForm">
                            <div class="form-group">
                                <label for="currentPassword">Текущий пароль</label>
                                <div style="position: relative;">
                                    <input type="password" id="currentPassword" required>
                                    <button type="button" class="toggle-password" data-target="currentPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword">Новый пароль</label>
                                <div style="position: relative;">
                                    <input type="password" id="newPassword" required minlength="8">
                                    <button type="button" class="toggle-password" data-target="newPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 5px;">
                                    Пароль должен содержать минимум 8 символов, включая цифры и буквы
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword">Подтвердите новый пароль</label>
                                <div style="position: relative;">
                                    <input type="password" id="confirmPassword" required>
                                    <button type="button" class="toggle-password" data-target="confirmPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div style="margin-top: var(--space-xl);">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-key"></i> Сменить пароль
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div style="border-top: 1px solid var(--gray-200); padding-top: var(--space-xl);">
                        <h4>Двухфакторная аутентификация</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="margin: 0; color: var(--text-light);">
                                    Добавьте дополнительный уровень безопасности к вашему аккаунту
                                </p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="twoFactorToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="border-top: 1px solid var(--gray-200); padding-top: var(--space-xl);">
                        <h4>Активные сессии</h4>
                        <div style="background: var(--gray-100); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-sm);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600;">Текущая сессия</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">
                                        Windows • Chrome • Москва
                                    </div>
                                    <div style="font-size: 0.8rem; color: var(--text-light);">
                                        Активна сейчас
                                    </div>
                                </div>
                                <div style="color: var(--success); font-weight: 600;">
                                    Текущая
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--white); padding: var(--space-md); border: 1px solid var(--gray-200); border-radius: var(--radius-md);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600;">iPhone 13</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">
                                        Safari • Москва
                                    </div>
                                    <div style="font-size: 0.8rem; color: var(--text-light);">
                                        Последняя активность: 2 дня назад
                                    </div>
                                </div>
                                <button class="btn btn-outline btn-small" style="color: var(--danger);">
                                    Завершить
                                </button>
                            </div>
                        </div>
                        
                        <button class="btn btn-outline btn-block" style="margin-top: var(--space-md);">
                            <i class="fas fa-sign-out-alt"></i> Завершить все другие сессии
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Вкладка Уведомления -->
            <div class="tab-pane" id="notificationsTab">
                <div class="dashboard-card">
                    <h3><i class="fas fa-bell"></i> Настройки уведомлений</h3>
                    
                    <div style="margin-bottom: var(--space-xl);">
                        <h4>Каналы уведомлений</h4>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md); padding: var(--space-md); background: var(--gray-100); border-radius: var(--radius-md);">
                            <div>
                                <div style="font-weight: 600;">Email уведомления</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">
                                    Получать уведомления на почту
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md); padding: var(--space-md); background: var(--gray-100); border-radius: var(--radius-md);">
                            <div>
                                <div style="font-weight: 600;">Push-уведомления</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">
                                    Уведомления в браузере
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="pushNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-md); background: var(--gray-100); border-radius: var(--radius-md);">
                            <div>
                                <div style="font-weight: 600;">SMS уведомления</div>
                                <div style="font-size: 0.9rem; color: var(--text-light);">
                                    Важные уведомления по SMS
                                </div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="smsNotifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="border-top: 1px solid var(--gray-200); padding-top: var(--space-xl);">
                        <h4>Типы уведомлений</h4>
                        
                        <div style="margin-top: var(--space-md);">
                            <div style="font-weight: 600; margin-bottom: var(--space-sm);">Новые уроки и задания</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-sm);">
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> Email
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> Push
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox"> SMS
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-top: var(--space-lg);">
                            <div style="font-weight: 600; margin-bottom: var(--space-sm);">Напоминания о дедлайнах</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-sm);">
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> Email
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> Push
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> SMS
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-top: var(--space-lg);">
                            <div style="font-weight: 600; margin-bottom: var(--space-sm);">Оценки и прогресс</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-sm);">
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> Email
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox"> Push
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox"> SMS
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-top: var(--space-lg);">
                            <div style="font-weight: 600; margin-bottom: var(--space-sm);">Вебинары и события</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-sm);">
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> Email
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked> Push
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox"> SMS
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: var(--space-xl); text-align: center;">
                        <button class="btn btn-primary">
                            <i class="fas fa-save"></i> Сохранить настройки
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../../js/personal.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Переключение вкладок
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Убираем активный класс у всех кнопок и панелей
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    // Добавляем активный класс текущим
                    this.classList.add('active');
                    document.getElementById(tabId + 'Tab').classList.add('active');
                });
            });
            
            // Загрузка аватара
            const changeAvatarBtn = document.getElementById('changeAvatarBtn');
            const avatarInput = document.getElementById('avatarInput');
            const avatarPreview = document.getElementById('avatarPreview');
            
            if (changeAvatarBtn) {
                changeAvatarBtn.addEventListener('click', function() {
                    avatarInput.click();
                });
            }
            
            if (avatarInput) {
                avatarInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            avatarPreview.innerHTML = `<img src="${event.target.result}" alt="Аватар" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Переключение видимости пароля
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.dataset.target;
                    const input = document.getElementById(targetId);
                    const icon = this.querySelector('i');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.className = 'fas fa-eye-slash';
                    } else {
                        input.type = 'password';
                        icon.className = 'fas fa-eye';
                    }
                });
            });
            
            // Форма профиля
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveProfile();
                });
            }
            
            // Форма смены пароля
            const passwordForm = document.getElementById('passwordForm');
            if (passwordForm) {
                passwordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    changePassword();
                });
            }
            
            // Кнопка отмены
            const cancelBtn = document.getElementById('cancelChangesBtn');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    if (confirm('Отменить все изменения?')) {
                        profileForm.reset();
                    }
                });
            }
            
            // Двухфакторная аутентификация
            const twoFactorToggle = document.getElementById('twoFactorToggle');
            if (twoFactorToggle) {
                twoFactorToggle.addEventListener('change', function() {
                    if (this.checked) {
                        setupTwoFactorAuth();
                    } else {
                        disableTwoFactorAuth();
                    }
                });
            }
            
            // Инициализация стилей для вкладок
            initTabStyles();
        });
        
        function initTabStyles() {
            const style = document.createElement('style');
            style.textContent = `
                .tabs {
                    display: flex;
                    gap: var(--space-xs);
                    border-bottom: 1px solid var(--gray-200);
                    padding-bottom: 5px;
                }
                
                .tab-btn {
                    padding: 12px 24px;
                    background: none;
                    border: none;
                    border-bottom: 3px solid transparent;
                    font-weight: 500;
                    color: var(--text-light);
                    cursor: pointer;
                    transition: all var(--transition-normal);
                    border-radius: var(--radius-sm) var(--radius-sm) 0 0;
                }
                
                .tab-btn:hover {
                    color: var(--primary);
                    background: var(--background-alt);
                }
                
                .tab-btn.active {
                    color: var(--primary);
                    border-bottom-color: var(--primary);
                    background: var(--background-alt);
                }
                
                .tab-pane {
                    display: none;
                }
                
                .tab-pane.active {
                    display: block;
                }
                
                .switch {
                    position: relative;
                    display: inline-block;
                    width: 60px;
                    height: 34px;
                }
                
                .switch input {
                    opacity: 0;
                    width: 0;
                    height: 0;
                }
                
                .slider {
                    position: absolute;
                    cursor: pointer;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background-color: var(--gray-300);
                    transition: .4s;
                    border-radius: 34px;
                }
                
                .slider:before {
                    position: absolute;
                    content: "";
                    height: 26px;
                    width: 26px;
                    left: 4px;
                    bottom: 4px;
                    background-color: white;
                    transition: .4s;
                    border-radius: 50%;
                }
                
                input:checked + .slider {
                    background-color: var(--primary);
                }
                
                input:checked + .slider:before {
                    transform: translateX(26px);
                }
                
                .checkbox-label {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 8px;
                    background: var(--white);
                    border: 1px solid var(--gray-200);
                    border-radius: var(--radius-sm);
                    cursor: pointer;
                }
                
                .toggle-password {
                    position: absolute;
                    right: 12px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    color: var(--text-light);
                    cursor: pointer;
                }
            `;
            document.head.appendChild(style);
        }
        
        function saveProfile() {
            const formData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                birthDate: document.getElementById('birthDate').value,
                city: document.getElementById('city').value,
                about: document.getElementById('about').value,
                education: document.getElementById('education').value,
                class: document.getElementById('class').value
            };
            
            // В реальном проекте здесь был бы AJAX запрос
            console.log('Сохранение профиля:', formData);
            
            showModal(`
                <h3>Профиль обновлён</h3>
                <p>Ваши данные успешно сохранены.</p>
                <div style="text-align: center; margin: var(--space-lg) 0;">
                    <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success);"></i>
                </div>
            `, 'Успешно');
        }
        
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showModal('<p>Новый пароль и подтверждение не совпадают.</p>', 'Ошибка');
                return;
            }
            
            if (newPassword.length < 8) {
                showModal('<p>Пароль должен содержать минимум 8 символов.</p>', 'Ошибка');
                return;
            }
            
            // В реальном проекте здесь был бы AJAX запрос
            console.log('Смена пароля');
            
            showModal(`
                <h3>Пароль изменён</h3>
                <p>Ваш пароль успешно обновлён.</p>
                <p style="font-size: 0.9rem; color: var(--text-light);">
                    В следующий раз используйте новый пароль для входа.
                </p>
            `, 'Успешно');
            
            // Очищаем форму
            document.getElementById('passwordForm').reset();
        }
        
        function setupTwoFactorAuth() {
            showModal(`
                <h3>Настройка двухфакторной аутентификации</h3>
                <p>Для включения двухфакторной аутентификации:</p>
                <ol>
                    <li>Установите приложение Google Authenticator</li>
                    <li>Отсканируйте QR-код ниже</li>
                    <li>Введите код из приложения</li>
                </ol>
                
                <div style="text-align: center; margin: var(--space-lg) 0;">
                    <div style="display: inline-block; padding: 20px; background: white; border: 1px solid var(--gray-200);">
                        [QR-код будет здесь]
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="authCode">Код из приложения</label>
                    <input type="text" id="authCode" placeholder="000000" maxlength="6">
                </div>
                
                <button class="btn btn-primary btn-block" id="confirm2FABtn">
                    Подтвердить и включить
                </button>
            `, 'Двухфакторная аутентификация');
            
            setTimeout(() => {
                document.getElementById('confirm2FABtn')?.addEventListener('click', function() {
                    showModal('<p>Двухфакторная аутентификация успешно включена!</p>', 'Успешно');
                });
            }, 100);
        }
        
        function disableTwoFactorAuth() {
            showModal(`
                <h3>Отключение двухфакторной аутентификации</h3>
                <p>Вы уверены, что хотите отключить двухфакторную аутентификацию?</p>
                <p style="color: var(--warning);">Это снизит безопасность вашего аккаунта.</p>
                
                <div style="display: flex; gap: var(--space-md); margin-top: var(--space-lg);">
                    <button class="btn btn-danger" id="confirmDisable2FA">
                        Да, отключить
                    </button>
                    <button class="btn btn-outline" onclick="document.querySelector('.modal-ok').click()">
                        Отмена
                    </button>
                </div>
            `, 'Подтверждение');
            
            setTimeout(() => {
                document.getElementById('confirmDisable2FA')?.addEventListener('click', function() {
                    document.getElementById('twoFactorToggle').checked = false;
                    showModal('<p>Двухфакторная аутентификация отключена.</p>', 'Успешно');
                });
            }, 100);
        }
        
        function showModal(content, title = '') {
            if (typeof window.showModal === 'function') {
                window.showModal(content, title);
            } else {
                alert(title + ': ' + content.replace(/<[^>]*>/g, ' '));
            }
        }
    </script>
</body>
</html>