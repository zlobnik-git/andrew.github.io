<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Прогресс обучения - EduFlow</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/personal.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js для графиков -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Боковая панель -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../../index.html" class="sidebar-logo">
                <i class="fas fa-graduation-cap"></i>
                <span>EduFlow</span>
            </a>
            
            <div class="user-profile">
                <div class="user-avatar">
                    <span>АЖ</span>
                </div>
                <div class="user-info">
                    <h3>Алексей Журавлев</h3>
                    <p>Ученик</p>
                </div>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Дашборд</span>
            </a>
            <a href="courses.html" class="nav-item">
                <i class="fas fa-book-open"></i>
                <span>Мои курсы</span>
            </a>
            <a href="progress.html" class="nav-item active">
                <i class="fas fa-chart-line"></i>
                <span>Прогресс</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Расписание</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-tasks"></i>
                <span>Задания</span>
                <span class="badge">3</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-file-alt"></i>
                <span>Материалы</span>
            </a>
            <a href="profile.html" class="nav-item">
                <i class="fas fa-user-cog"></i>
                <span>Настройки</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <a href="../../index.html" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Выйти</span>
            </a>
        </div>
    </aside>

    <!-- Основной контент -->
    <main class="personal-content">
        <header class="personal-header">
            <div>
                <h1>Прогресс обучения</h1>
                <p>Статистика и аналитика вашего обучения</p>
            </div>
            
            <div class="header-actions">
                <button class="mobile-menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="search-box">
                    <i class="fas fa-calendar-alt"></i>
                    <select id="periodSelect" style="border: none; background: transparent; padding: 12px 16px 12px 40px; width: 100%; font-size: 0.95rem;">
                        <option value="month">За последний месяц</option>
                        <option value="3months" selected>За 3 месяца</option>
                        <option value="6months">За 6 месяцев</option>
                        <option value="year">За год</option>
                        <option value="all">За всё время</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="exportBtn">
                    <i class="fas fa-download"></i> Экспорт данных
                </button>
            </div>
        </header>

        <!-- Статистика -->
        <div class="dashboard-grid" style="margin-bottom: var(--space-2xl);">
            <div class="dashboard-card">
                <h3><i class="fas fa-trophy"></i> Общий прогресс</h3>
                <div class="card-stat">76%</div>
                <p>Средний прогресс по всем курсам</p>
                <div style="margin-top: var(--space-md);">
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px;">
                        <span>Лучший курс: Математика</span>
                        <span>75%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin: 10px 0 5px;">
                        <span>Самый сложный: Информатика</span>
                        <span>60%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%"></div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-clock"></i> Активность</h3>
                <div class="card-stat">48 ч</div>
                <p>Всего времени обучения</p>
                <div style="margin-top: var(--space-md);">
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                        <span><i class="fas fa-calendar-day"></i> Среднее в день:</span>
                        <span>1.2 ч</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-top: 5px;">
                        <span><i class="fas fa-fire"></i> Дней подряд:</span>
                        <span>14</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-top: 5px;">
                        <span><i class="fas fa-crown"></i> Место в рейтинге:</span>
                        <span>15/200</span>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-check-circle"></i> Успеваемость</h3>
                <div class="card-stat">4.7</div>
                <p>Средний балл по заданиям</p>
                <div style="margin-top: var(--space-md);">
                    <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                        <i class="fas fa-star" style="color: #F59E0B;"></i>
                        <i class="fas fa-star" style="color: #F59E0B;"></i>
                        <i class="fas fa-star" style="color: #F59E0B;"></i>
                        <i class="fas fa-star" style="color: #F59E0B;"></i>
                        <i class="fas fa-star-half-alt" style="color: #F59E0B;"></i>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--text-light);">
                        Выполнено заданий: <strong>42 из 50</strong>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--text-light); margin-top: 5px;">
                        Среднее время выполнения: <strong>45 мин</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Графики -->
        <section style="margin-bottom: var(--space-2xl);">
            <h2 style="margin-bottom: var(--space-lg);">Графики прогресса</h2>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Прогресс по курсам</h3>
                    <canvas id="coursesChart" height="250"></canvas>
                </div>
                
                <div class="dashboard-card">
                    <h3>Активность по дням</h3>
                    <canvas id="activityChart" height="250"></canvas>
                </div>
            </div>
        </section>

        <!-- Детальная статистика -->
        <section style="margin-bottom: var(--space-2xl);">
            <h2 style="margin-bottom: var(--space-lg);">Детальная статистика по курсам</h2>
            
            <div class="courses-list">
                <div class="course-item">
                    <div class="course-icon">
                        <i class="fas fa-square-root-alt"></i>
                    </div>
                    <div class="course-info">
                        <h4>Математика ЕГЭ профиль</h4>
                        <p>Прогресс: 75% • Средний балл: 4.8 • Время: 32 ч</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-md); margin-top: var(--space-sm);">
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-light);">Уроков пройдено</div>
                                <div style="font-weight: 600; color: var(--primary);">18/24</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-light);">Заданий выполнено</div>
                                <div style="font-weight: 600; color: var(--primary);">22/30</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-light);">Средний результат</div>
                                <div style="font-weight: 600; color: var(--primary);">92%</div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-outline detailed-btn" data-course="math">
                        Подробнее
                    </button>
                </div>
                
                <div class="course-item">
                    <div class="course-icon">
                        <i class="fas fa-laptop-code"></i>
                    </div>
                    <div class="course-info">
                        <h4>Информатика ЕГЭ</h4>
                        <p>Прогресс: 60% • Средний балл: 4.5 • Время: 24 ч</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-md); margin-top: var(--space-sm);">
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-light);">Уроков пройдено</div>
                                <div style="font-weight: 600; color: var(--primary);">12/20</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-light);">Заданий выполнено</div>
                                <div style="font-weight: 600; color: var(--primary);">15/25</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-light);">Средний результат</div>
                                <div style="font-weight: 600; color: var(--primary);">85%</div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-outline detailed-btn" data-course="informatics">
                        Подробнее
                    </button>
                </div>
            </div>
        </section>

        <!-- Достижения -->
        <section>
            <h2 style="margin-bottom: var(--space-lg);">Ваши достижения</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: var(--space-md);">
                <div style="text-align: center; padding: var(--space-md); background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #FEF3C7, #FDE68A); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-sm);">
                        <i class="fas fa-fire" style="color: #D97706; font-size: 1.5rem;"></i>
                    </div>
                    <h4 style="margin: 0 0 5px 0;">14 дней подряд</h4>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin: 0;">Непрерывное обучение</p>
                </div>
                
                <div style="text-align: center; padding: var(--space-md); background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #DBEAFE, #BFDBFE); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-sm);">
                        <i class="fas fa-trophy" style="color: #2563EB; font-size: 1.5rem;"></i>
                    </div>
                    <h4 style="margin: 0 0 5px 0;">Топ-15</h4>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin: 0;">В рейтинге студентов</p>
                </div>
                
                <div style="text-align: center; padding: var(--space-md); background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #D1FAE5, #A7F3D0); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-sm);">
                        <i class="fas fa-check-double" style="color: #059669; font-size: 1.5rem;"></i>
                    </div>
                    <h4 style="margin: 0 0 5px 0;">42 задания</h4>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin: 0;">Успешно выполнено</p>
                </div>
                
                <div style="text-align: center; padding: var(--space-md); background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #FCE7F3, #FBCFE8); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-sm);">
                        <i class="fas fa-brain" style="color: #DB2777; font-size: 1.5rem;"></i>
                    </div>
                    <h4 style="margin: 0 0 5px 0;">Быстрое обучение</h4>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin: 0;">Выше среднего на 30%</p>
                </div>
            </div>
        </section>
    </main>

    <script src="../../js/personal.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация графиков
            initCharts();
            
            // Изменение периода
            const periodSelect = document.getElementById('periodSelect');
            if (periodSelect) {
                periodSelect.addEventListener('change', function() {
                    updateCharts(this.value);
                });
            }
            
            // Экспорт данных
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportProgressData);
            }
            
            // Кнопки подробной статистики
            document.querySelectorAll('.detailed-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const course = this.dataset.course;
                    showDetailedStats(course);
                });
            });
        });
        
        function initCharts() {
            // График прогресса по курсам
            const coursesCtx = document.getElementById('coursesChart').getContext('2d');
            window.coursesChart = new Chart(coursesCtx, {
                type: 'bar',
                data: {
                    labels: ['Математика', 'Информатика', 'Русский', 'Физика'],
                    datasets: [{
                        label: 'Прогресс (%)',
                        data: [75, 60, 100, 0],
                        backgroundColor: [
                            'rgba(37, 99, 235, 0.7)',
                            'rgba(16, 185, 129, 0.7)',
                            'rgba(59, 130, 246, 0.7)',
                            'rgba(209, 213, 219, 0.7)'
                        ],
                        borderColor: [
                            'rgb(37, 99, 235)',
                            'rgb(16, 185, 129)',
                            'rgb(59, 130, 246)',
                            'rgb(209, 213, 219)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // График активности
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            window.activityChart = new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: ['1 нед', '2 нед', '3 нед', '4 нед', '5 нед', '6 нед', '7 нед'],
                    datasets: [{
                        label: 'Часы обучения',
                        data: [8, 7, 9, 6, 8, 10, 7],
                        borderColor: 'rgb(37, 99, 235)',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }
        
        function updateCharts(period) {
            // В реальном проекте здесь был бы AJAX запрос за данными
            console.log('Обновление графиков для периода:', period);
            
            // Обновляем данные графиков
            if (window.coursesChart) {
                const newData = {
                    'month': [65, 50, 100, 0],
                    '3months': [75, 60, 100, 0],
                    '6months': [85, 70, 100, 30],
                    'year': [90, 80, 100, 50],
                    'all': [95, 85, 100, 70]
                };
                
                window.coursesChart.data.datasets[0].data = newData[period] || newData['3months'];
                window.coursesChart.update();
            }
        }
        
        function exportProgressData() {
            showModal(`
                <h3>Экспорт данных</h3>
                <p>Выберите формат для экспорта вашей статистики:</p>
                
                <div style="display: grid; gap: var(--space-sm); margin: var(--space-lg) 0;">
                    <button class="btn btn-outline btn-block" id="exportPDF">
                        <i class="fas fa-file-pdf"></i> PDF отчет
                    </button>
                    
                    <button class="btn btn-outline btn-block" id="exportExcel">
                        <i class="fas fa-file-excel"></i> Excel таблица
                    </button>
                    
                    <button class="btn btn-outline btn-block" id="exportCSV">
                        <i class="fas fa-file-csv"></i> CSV данные
                    </button>
                    
                    <button class="btn btn-outline btn-block" id="exportJSON">
                        <i class="fas fa-code"></i> JSON данные
                    </button>
                </div>
                
                <div style="background: var(--gray-100); padding: var(--space-md); border-radius: var(--radius-md);">
                    <h4 style="margin-top: 0;">Что будет включено:</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>Статистика по всем курсам</li>
                        <li>Графики прогресса</li>
                        <li>Детальная успеваемость</li>
                        <li>Достижения и награды</li>
                    </ul>
                </div>
            `, 'Экспорт данных');
            
            setTimeout(() => {
                document.getElementById('exportPDF')?.addEventListener('click', function() {
                    downloadFile('pdf');
                });
                document.getElementById('exportExcel')?.addEventListener('click', function() {
                    downloadFile('excel');
                });
                document.getElementById('exportCSV')?.addEventListener('click', function() {
                    downloadFile('csv');
                });
                document.getElementById('exportJSON')?.addEventListener('click', function() {
                    downloadFile('json');
                });
            }, 100);
        }
        
        function downloadFile(format) {
            showModal(`
                <h3>Экспорт завершён</h3>
                <p>Ваши данные успешно экспортированы в формате ${format.toUpperCase()}.</p>
                <p>В реальном проекте файл автоматически скачается.</p>
                <div style="text-align: center; margin: var(--space-lg) 0;">
                    <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success);"></i>
                </div>
                <p style="text-align: center; font-size: 0.9rem; color: var(--text-light);">
                    Размер файла: ~${format === 'pdf' ? '1.2' : format === 'excel' ? '0.8' : '0.3'} МБ
                </p>
            `, 'Экспорт завершён');
        }
        
        function showDetailedStats(course) {
            const courseData = {
                'math': {
                    name: 'Математика ЕГЭ профиль',
                    stats: {
                        totalLessons: 24,
                        completedLessons: 18,
                        totalTasks: 30,
                        completedTasks: 22,
                        averageScore: 4.8,
                        timeSpent: '32 часа',
                        bestTopic: 'Производные',
                        weakTopic: 'Геометрия'
                    }
                },
                'informatics': {
                    name: 'Информатика ЕГЭ',
                    stats: {
                        totalLessons: 20,
                        completedLessons: 12,
                        totalTasks: 25,
                        completedTasks: 15,
                        averageScore: 4.5,
                        timeSpent: '24 часа',
                        bestTopic: 'Алгоритмы',
                        weakTopic: 'Программирование'
                    }
                }
            };
            
            const data = courseData[course] || courseData.math;
            
            const modalContent = `
                <h3>Детальная статистика: ${data.name}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); margin: var(--space-lg) 0;">
                    <div style="background: var(--gray-100); padding: var(--space-md); border-radius: var(--radius-md);">
                        <div style="font-size: 0.9rem; color: var(--text-light);">Уроков пройдено</div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary);">
                            ${data.stats.completedLessons}/${data.stats.totalLessons}
                        </div>
                        <div class="progress-bar" style="margin-top: 10px;">
                            <div class="progress-fill" style="width: ${(data.stats.completedLessons/data.stats.totalLessons)*100}%"></div>
                        </div>
                    </div>
                    
                    <div style="background: var(--gray-100); padding: var(--space-md); border-radius: var(--radius-md);">
                        <div style="font-size: 0.9rem; color: var(--text-light);">Заданий выполнено</div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary);">
                            ${data.stats.completedTasks}/${data.stats.totalTasks}
                        </div>
                        <div class="progress-bar" style="margin-top: 10px;">
                            <div class="progress-fill" style="width: ${(data.stats.completedTasks/data.stats.totalTasks)*100}%"></div>
                        </div>
                    </div>
                </div>
                
                <div style="background: var(--background-alt); padding: var(--space-md); border-radius: var(--radius-md);">
                    <h4 style="margin-top: 0;">Другие показатели:</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md);">
                        <div>
                            <strong>Средний балл:</strong>
                            <div style="color: var(--primary); font-weight: 600;">${data.stats.averageScore}/5.0</div>
                        </div>
                        
                        <div>
                            <strong>Время обучения:</strong>
                            <div style="color: var(--primary); font-weight: 600;">${data.stats.timeSpent}</div>
                        </div>
                        
                        <div>
                            <strong>Лучшая тема:</strong>
                            <div style="color: var(--success); font-weight: 600;">${data.stats.bestTopic}</div>
                        </div>
                        
                        <div>
                            <strong>Слабая тема:</strong>
                            <div style="color: var(--warning); font-weight: 600;">${data.stats.weakTopic}</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: var(--space-lg);">
                    <h4>Рекомендации:</h4>
                    <ul>
                        <li>Сосредоточьтесь на теме "${data.stats.weakTopic}"</li>
                        <li>Попробуйте дополнительные практические задания</li>
                        <li>Посмотрите вебинары по сложным темам</li>
                    </ul>
                </div>
            `;
            
            showModal(modalContent, 'Детальная статистика');
        }
        
        function showModal(content, title = '') {
            if (typeof window.showModal === 'function') {
                window.showModal(content, title);
            } else {
                alert(title + ': ' + content.replace(/<[^>]*>/g, ' '));
            }
        }
    </script>
</body>
</html>